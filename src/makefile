# makefile for running VSG on all VHDL source files

# autogenerated
EXCLUSIONS:=\
	./common/basic/intel_cyclone_v/pll_50m_32m/pll_50m_32m.vhd \
	./common/basic/intel_cyclone_v/pll_otus_50m_96m_32m/pll_otus_50m_96m_32m.vhd \
	./common/basic/intel_cyclone_v/pll_otus_50m_96m_32m__28/pll_otus_50m_96m_32m.vhd

# tabular layout
EXCLUSIONS:=$(EXCLUSIONS) \
	./common/ps2/ps2set2_to_usbhid_pkg.vhd \
	./common/video_out/char_rom_437_8x16.vhd \
	./designs/bpp/bpp_kbd_ps2.vhd

# incomplete
EXCLUSIONS:=$(EXCLUSIONS) \
	./common/retro/r6522/r6522.vhd \
	./designs/bpp/bpp_map.vhd \
	./designs/bpp/qmtech_wukong/bpp_qmtech_wukong.vhd \
	./designs/bpp/qmtech_wukong/tb_bpp_qmtech_wukong.vhd \
	./designs/bpp/test/tb_bpp.vhd \
	./designs/bpp/test/tb_bpp_hdtv.vhd

$(info THE FOLLOWING FILES ARE EXCLUDED:)
$(foreach X,$(EXCLUSIONS),$(eval $(info $X)))
$(info  )

SOURCES:=$(filter-out $(EXCLUSIONS),$(shell find . -type f -name *.vhd))

define RR_VSG
.vsg:: $1
	vsg -c vsg.yml -f $1 --fix 2>&1
	touch .vsg
endef
$(foreach s,$(SOURCES),$(eval $(call RR_VSG,$s)))

all: .vsg

clean:
	find . -name "*.vhd" -type f -exec touch {} \;
